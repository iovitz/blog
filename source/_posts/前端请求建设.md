---
title: 前端请求建设
description: 前端请求建设
author: 不锈钢盆
date: 2023-06-06 17:12:05
categories: 前端
tags:
  - 前端
  - 请求
  - Axios
  - 稳定性
---

# 请求封装

# 错误码规范

前端和服务端应该有统一的错误码规范，每个错误码都应该有唯一的语义，后端返回给前端错误码时，前端根据不同的错误码执行不同的操作，


# 接口稳定性
## 接口重试

接口重试是接口稳定性中非常重要的点，接口重试的应用场景主要有：
* 用户网络情况较差
* 服务端出现故障抖动，无法及时响应前端请求

接口重试需要设计好重试的策略，并且定好最大重试次数（一般情况下需要避免无限重试），同时也要做好对后端错误码的处理，前端和后端应该约定好几个固定的重复语义的错误码，前端收到错误码时，根据错误码判断是否需要重试

常见的接口重试策略有两种：
* 定时重试（3，3，3，3，3...）：重试时间固定
* 冪次退避重试（1，4，9，16，25...）：重试间隔会慢慢变长，当服务器出现故障时，采取退避重试可以避免对服务器造成大冲击



```ts
const fetchRemoteData = (retryTime = 1) {
  const retry = (err: any)=> {
    if (retryTime > 3) {
      return Promise.reject(err);
    }
    return new Promise((resolve, reject) => {
      setTimeout(
        () => fetchRemoteData().then(resolve, reject), Math.pow(retryTime, 2) * 1000,
      );
    });
  };

  return axios.get('/api/config').then((res) => {

  }, () => retry(retryTime + 1))
}
```

## 接口并发限制



